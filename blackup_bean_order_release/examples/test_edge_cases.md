# 🧪 골든 테스트 #3: 엣지 케이스 시나리오

> **시나리오**: 빈 시트 + 수량 0kg + 이상 수량(>50kg) + 시트 접근 불가 + 날짜 형식 오류 + 필수 컬럼 누락
> **목적**: 각 엣지 케이스에서 에이전트가 올바른 등급의 경고를 표시하고, 데이터 무결성을 유지하는지 확인
> **검증 방법**: 핵심 수치만 추출하여 비교 (출력 형식 차이 무시). 원본 행 수, 유효 건수, 경고 등급별 건수가 기대값과 일치하는지 확인.

---

## 입력 데이터

### settings.yaml 상태

```yaml
stores: [서면본점(SM), 해운대(HD), 양산(YS)]
beans:
  - ETH-YRG: stock_kg: 30
  - COL-SUP: stock_kg: 15
  - BRA-SAN: stock_kg: 25
min_lead_days: 2
max_order_kg: 50
```

### 서면본점 Sheets (3건 — 이상 수량, 0kg, 날짜 형식 오류)

| 주문일 | 매장코드 | 매장명 | 원두코드 | 원두명 | 수량(kg) | 배송희망일 | 로스팅단계 | 분쇄여부 | 긴급여부 | 비고 | 주문자 | 연락처 |
|--------|---------|--------|---------|--------|---------|-----------|-----------|---------|---------|------|--------|--------|
| 2026-02-15 | SM | 서면본점 | ETH-YRG | 에티오피아 예가체프 | 80 | 2026-02-18 | 미디엄 | 홀빈 | N | | 김철수 | 010-1234-5678 |
| 2026-02-15 | SM | 서면본점 | COL-SUP | 콜롬비아 수프리모 | 0 | 2026-02-18 | 다크 | 분쇄 | N | | 이영희 | 010-9876-5432 |
| 2/15 | SM | 서면본점 | BRA-SAN | 브라질 산토스 | 5 | 2026-02-18 | 라이트 | 홀빈 | N | | 박준호 | 010-4444-5555 |

> ⚠️ 1행: 수량 80kg > max_order_kg(50)
> ⚠️ 2행: 수량 0kg
> ⚠️ 3행: 날짜 `2/15` — YYYY-MM-DD 형식이 아님

### 해운대 Sheets — **빈 시트** (0건)

| 주문일 | 매장코드 | 매장명 | 원두코드 | 원두명 | 수량(kg) | 배송희망일 | 로스팅단계 | 분쇄여부 | 긴급여부 | 비고 | 주문자 | 연락처 |
|--------|---------|--------|---------|--------|---------|-----------|-----------|---------|---------|------|--------|--------|
| *(데이터 없음)* | | | | | | | | | | | | |

> ℹ️ 헤더만 있고 주문 데이터 0행

### 양산 Sheets — **접근 불가**

> ❌ Sheets URL 열기 실패 (공유 설정 오류 또는 URL 변경)
> 시뮬레이션: 에이전트가 양산 sheet_url에 접근 시도 → HTTP 403 또는 페이지 로드 실패

### [추가] 필수 컬럼 누락 테스트 데이터 (서면본점 별도 행)

아래 행은 "원두코드"와 "수량" 필수 컬럼이 비어 있는 경우:

| 주문일 | 매장코드 | 매장명 | 원두코드 | 원두명 | 수량(kg) | 배송희망일 | 로스팅단계 | 분쇄여부 | 긴급여부 | 비고 | 주문자 | 연락처 |
|--------|---------|--------|---------|--------|---------|-----------|-----------|---------|---------|------|--------|--------|
| 2026-02-15 | SM | 서면본점 | | 에티오피아 예가체프 | | 2026-02-18 | 미디엄 | 홀빈 | N | | 최수연 | 010-6666-7777 |

> ❌ 원두코드, 수량(kg) 필수 컬럼 누락

---

## 기대 출력 (핵심 수치)

### 집계 결과

| 항목 | 기대값 | 설명 |
|------|--------|------|
| **원본 총 행 수** | 4행 | 서면본점 3행 + 필수 컬럼 누락 1행 (해운대 0행, 양산 접근 불가) |
| **유효 주문 건수** | 3건 | 원본 4행 중 필수 컬럼 누락 1행 스킵 → 유효 3건 |
| **총 수량** | 85.0kg | 80 + 0 + 5 = 85 (경고 포함 접수, 스킵 행 제외) |
| **처리 매장 수** | 2개 | 서면본점 + 해운대 (양산은 접근 불가로 스킵) |

> **원본 행 vs 유효 건수 구분**: 원본 Sheets의 행 수와 실제 집계에 포함되는 유효 주문 건수는 다를 수 있다.
> 필수 컬럼 누락, 파싱 에러 등으로 건너뛴 행은 유효 건수에서 제외되며, 리포트에 스킵 사유를 명시한다.

### 기대 경고 목록

| # | 검증 항목 | 기대 등급 | 기대 내용 | 기대 권장 조치 |
|---|----------|----------|----------|--------------|
| 12 | 이상 수량 | ⚠️ WARNING | 서면본점 ETH-YRG: 80kg > max_order_kg(50) | 오타 확인, 매장에 확인 연락 |
| 13 | 수량 0 | ⚠️ WARNING | 서면본점 COL-SUP: 수량 0kg | 의도된 주문인지 매장에 확인 |
| 8 | 날짜 형식 | ⚠️ WARNING | 서면본점 BRA-SAN: `2/15` — YYYY-MM-DD 아님 | 해당 매장에 형식 수정 요청 |
| — | 빈 시트 | ℹ️ INFO | 해운대: 주문 0건 | (정상 처리) |
| 14 | 시트 접근 | ❌ CRITICAL | 양산: Sheets 접근 불가 | 공유 설정·URL 확인 |
| 10 | 필수 컬럼 누락 | ❌ CRITICAL | 서면본점: 원두코드·수량 미입력 행 존재 | 해당 매장에 보충 요청 |
| 5 | 재고 부족 | ⚠️ WARNING | ETH-YRG: 주문 80kg > 재고 30kg | 생두 발주 또는 매장 수량 조율 |

### 경고 요약

| 등급 | 건수 |
|------|------|
| ❌ CRITICAL | 2건 (시트 접근 불가, 필수 컬럼 누락) |
| ⚠️ WARNING | 4건 (이상 수량, 수량 0, 날짜 형식, 재고 부족) |
| ℹ️ INFO | 1건 (빈 시트) |

---

## 에이전트 동작 확인 포인트

| # | 확인 사항 | 기대 동작 |
|---|----------|----------|
| 1 | 이상 수량(80kg) 주문 | 주문 접수 + ⚠️ 경고 (차단 아님) |
| 2 | 수량 0kg 주문 | 주문 접수 + ⚠️ 경고 (차단 아님) |
| 3 | 잘못된 날짜 형식 | 해당 행 주문 접수 + ⚠️ 경고 |
| 4 | 빈 시트 (0건) | "해운대 주문 없음" ℹ️ INFO로 정상 처리 |
| 5 | 시트 접근 불가 | 양산만 스킵, 나머지 정상 처리 + ❌ CRITICAL |
| 6 | 필수 컬럼 누락 | 해당 행 건너뛰기 + ❌ CRITICAL |
| 7 | 부분 데이터 리포트 | 양산 제외한 나머지로 리포트 생성 **가능** (단, 시트 접근 불가는 명시) |
