# 🔄 로스터 관점 설계 비판 & 개선 (5 Rounds)

> 현재 설계안을 로스터(원두 생산자) 입장에서 5회 반복 비판하고,
> 각 제안을 다른 로스터 관점에서 재검증하여 수용 여부를 결정합니다.

---

## Round 1: 재고/생두 수량 관리

### 🔴 비판 (로스터 A)
> "주문 수량만 보여주면 뭐하나? 내가 가진 **생두 재고**가 충분한지를 모르면
> 주문을 받아놓고 생산을 못하는 상황이 생긴다. 에티오피아 예가체프 15kg 주문이
> 들어왔는데 생두가 10kg밖에 없으면? 이걸 모르고 배송 약속을 잡는 건 큰 문제다."

**제안**: `settings.yaml`에 원두별 현재 재고량을 관리하고, 주문 합산 시 **재고 초과 경고** 표시

### 🟢 반론 (로스터 B)
> "재고 관리는 분명 중요하지만, 이 시스템은 **주문 정리** 도구야.
> 재고 관리까지 넣으면 scope가 커지고, 재고 데이터를 실시간으로 유지하는 것도
> 별도 작업이야. 다만 **주문 합산 결과와 함께 재고 비교 알림** 정도는 유용하다.
> 재고 데이터를 별도 Sheets 탭에 관리하고, 리포트에서 참조하는 수준이면 적절해."

### ✅ 결정: **수용 (축소 적용)**

- 별도의 재고 관리 시스템은 scope 밖
- 단, `settings.yaml`에 원두별 **대략적 가용 재고**를 기록하고
- 리포트에서 `주문량 > 재고` 시 ⚠️ **재고 부족 경고** 표시
- 추가 컬럼: 리포트 "원두별 총 주문량" 테이블에 `재고(kg)` | `과부족` 컬럼 추가

---

## Round 2: 로스팅 리드타임 & 납기 경고

### 🔴 비판 (로스터 A)
> "매장에서 오늘 주문하고 내일 배송 원한다고? 로스팅에 최소 하루,
> 디개싱(가스 빼기)에 1~2일 필요한데! **배송희망일이 비현실적인 주문**을
> 자동으로 걸러주지 않으면, 매번 수작업으로 확인해야 해."

**제안**: 로스팅 리드타임(최소 소요일)을 설정하고, 배송희망일이 리드타임 미만인 주문에 경고

### 🟢 반론 (로스터 B)
> "맞는 말이야. 근데 리드타임은 원두마다 다르고, 이미 로스팅해둔 재고가 있으면
> 당일 출고도 가능해. 너무 엄격하면 오히려 불편해질 수 있어.
> **경고만 표시**하고 최종 판단은 관리자가 하는 게 맞아."

### ✅ 결정: **수용**

- `settings.yaml`에 `min_lead_days: 2` (기본 최소 리드타임) 추가
- 배송희망일 - 주문일 < min_lead_days → ⚠️ **납기 촉박 경고**
- 차단이 아닌 **경고 표시**로, 최종 판단은 관리자에게 위임

---

## Round 3: 주문 이력/트렌드 비교

### 🔴 비판 (로스터 A)
> "매일 주문만 정리하면 큰 그림이 안 보여. 강남점이 지난달 대비
> 에티오피아 주문을 2배로 늘렸다면 수요 변화를 감지해야 생두 발주 계획을
> 세울 수 있어. **전주 대비, 전월 대비 비교**가 없으면 반쪽짜리야."

**제안**: 일일 리포트에 전주 동일 요일 / 전월 같은 날 대비 변동량 표시

### 🟢 반론 (로스터 B)
> "트렌드 분석은 가치 있지만, 이건 v1 범위를 넘어. 현재 시스템은
> Google Sheets를 브라우저로 읽는 구조인데, 과거 데이터까지 순회하면
> 에이전트 실행 시간이 크게 늘어나고 복잡도가 올라가.
> **v1에서는 생략하고 v2 로드맵에 포함**하는 게 현실적이야."

### ❌ 결정: **보류 (v2 로드맵)**

- 현재 구조에서 과거 데이터 순회는 실행 시간 및 복잡도 측면에서 과도함
- v2 로드맵에 "주간/월간 트렌드 분석" 기능으로 등록

---

## Round 4: 주문 마감 시간 & 중복 주문 감지

### 🔴 비판 (로스터 A)
> "매장이 하루에 여러 번 시트를 수정하면 어떡하지? 아침에 5kg 넣었다가
> 오후에 8kg로 바꾸면 에이전트가 언제 읽느냐에 따라 결과가 달라져.
> 그리고 같은 매장이 같은 원두를 실수로 두 줄 넣으면? **중복 주문 감지**가 없으면
> 배로 생산하게 돼."

**제안**:
1. 주문 마감 시간 개념 도입 (예: 매일 17시 이후 집계)
2. 동일 매장+동일 원두+동일 날짜 중복 행 감지 및 경고

### 🟢 반론 (로스터 B)
> "마감 시간은 운영 규칙이지 시스템이 강제할 건 아니야.
> SKILL.md에 '마감 시간 이후 실행 권장' 가이드만 넣으면 돼.
> 하지만 **중복 주문 감지**는 필수야! 같은 매장이 같은 원두를 같은 날에
> 두 번 넣은 건 거의 100% 실수니까. 이건 교차검증 단계에 넣어야 해."

### ✅ 결정: **부분 수용**

- 마감 시간: 시스템 강제 아닌 **SKILL.md 가이드**에만 언급 ("17시 이후 실행 권장")
- 중복 주문 감지: **교차검증 단계에 추가** — 동일 매장+원두+날짜 중복 행 발견 시 ⚠️ 경고

---

## Round 5: 매장별 주문 확인/접수 피드백

### 🔴 비판 (로스터 A)
> "주문을 정리하는 건 좋은데, 매장 입장에선 **주문이 잘 접수됐는지**
> 확인할 방법이 없어. 시트에 입력하고 나서 '이거 관리자가 봤나?'
> 불안해하는 매장이 분명 있을 거야. 접수 확인 피드백이 필요해."

**제안**: 리포트 생성 후 각 매장 Sheets에 "접수 완료" 상태 컬럼 자동 업데이트

### 🟢 반론 (로스터 B)
> "좋은 아이디어지만 위험해. 에이전트가 원본 Sheets에 **쓰기** 작업을 하면
> 실수로 데이터를 덮어쓸 위험이 있어. 읽기 전용이 안전하지.
> 매장 확인용이라면 **별도 공유 리포트 문서**나 **메신저 알림**이 더 적합해.
> 그건 이 시스템 scope 밖이고, 관리자가 리포트 보고 매장에 직접 연락하는 게
> 현재로선 가장 현실적이야."

### ❌ 결정: **보류**

- 원본 Sheets 쓰기는 데이터 무결성 위험
- 매장 피드백은 별도 커뮤니케이션 채널(카카오톡, 이메일 등)로 처리
- v2에서 "리포트 자동 공유" 기능 검토 가능

---

## 📊 결과 요약

| Round | 제안 | 결정 | 반영 내용 |
|-------|------|------|-----------|
| 1 | 재고 부족 경고 | ✅ 수용 | 원두별 가용 재고 + 과부족 경고 |
| 2 | 납기 촉박 경고 | ✅ 수용 | min_lead_days 설정 + 경고 표시 |
| 3 | 트렌드 비교 | ❌ 보류 | v2 로드맵 등록 |
| 4 | 중복 주문 감지 | ✅ 부분 수용 | 교차검증에 중복 감지 추가 |
| 5 | 접수 확인 피드백 | ❌ 보류 | 별도 커뮤니케이션으로 처리 |

### 반영 항목 상세

**settings.yaml 추가:**
```yaml
beans:
  - name: "에티오피아 예가체프"
    code: "ETH-YRG"
    stock_kg: 30          # 가용 재고 (NEW)

min_lead_days: 2          # 최소 로스팅 리드타임 (NEW)
```

**리포트 "원두별 총 주문량" 테이블 변경:**
```markdown
| 원두명             | 코드     | 총 수량(kg) | 재고(kg) | 과부족  | 주문 매장 수 |
|-------------------|----------|------------|---------|--------|------------|
| 에티오피아 예가체프  | ETH-YRG  | 15         | 30      | +15    | 3          |
| 콜롬비아 수프리모   | COL-SUP  | 8          | 5       | ⚠️ -3  | 2          |
```

**교차검증 테이블 추가 항목:**
```markdown
| 항목 | 원본 | 리포트 | 결과 |
|------|------|--------|------|
| 중복 주문 | 0건 | - | ✅ 중복 없음 |
| 납기 촉박 | 1건 | - | ⚠️ 강남점 COL-SUP (배송희망일 1일 후) |
```

**v2 로드맵 (향후 고려):**
- 주간/월간 트렌드 분석
- 리포트 자동 공유 (메신저/이메일)
- 매장 접수 확인 피드백
